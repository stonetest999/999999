<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>Gemini è²ªé£Ÿè›‡ (åœ–å½¢ç‰ˆ)</title>
    <style>
        body {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            background-color: #2b3a42; /* æ·±è—ç°è‰²èƒŒæ™¯ */
            color: white;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        h1 {
            margin-top: 0;
            text-shadow: 2px 2px 4px #000;
        }
        canvas {
            border: 5px solid #57606f;
            background-color: #a4b0be; /* æ·ºç°è‰²åœ°æ¿ */
            background-image: radial-gradient(#ced6e0 15%, transparent 16%),
            radial-gradient(#ced6e0 15%, transparent 16%); /* é»é»èƒŒæ™¯ */
            background-size: 20px 20px;
            background-position: 0 0, 10px 10px;
            box-shadow: 0 0 30px rgba(0, 0, 0, 0.5);
            border-radius: 10px;
        }
        .score-board {
            font-size: 24px;
            margin-bottom: 10px;
            background: rgba(0,0,0,0.3);
            padding: 5px 20px;
            border-radius: 20px;
        }
        .instructions {
            margin-top: 15px;
            color: #dfe4ea;
            font-size: 14px;
            text-align: center;
        }
    </style>
</head>
<body>

    <h1>ğŸ è²ªé£Ÿè›‡ï¼šåœ–å½¢é€²åŒ–ç‰ˆ</h1>
    <div class="score-board">ğŸ å¾—åˆ†: <span id="score">0</span></div>
    
    <canvas id="gameCanvas" width="400" height="400"></canvas>

    <div class="instructions">
        â¬†ï¸ â¬‡ï¸ â¬…ï¸ â¡ï¸ æ§åˆ¶æ–¹å‘<br>
        è‹¥æ˜¯åœ–ç‰‡æ²’é¡¯ç¤ºï¼Œè«‹æª¢æŸ¥ç¶²è·¯é€£ç·š
    </div>

    <script>
        const canvas = document.getElementById("gameCanvas");
        const ctx = canvas.getContext("2d");

        const box = 20; // æ ¼å­å¤§å°
        const canvasSize = 400; 

        // --- è¼‰å…¥åœ–ç‰‡è³‡æº ---
        // ä½¿ç”¨å…è²»åœ–åº«çš„ URLã€‚å¦‚æœåœ–ç‰‡é€£çµå¤±æ•ˆï¼Œä¸‹æ–¹çš„ç¨‹å¼ç¢¼æœƒè‡ªå‹•æ”¹å›ç•«æ–¹å¡Šã€‚
        const appleImg = new Image();
        appleImg.src = "https://img.icons8.com/color/48/apple.png"; // è˜‹æœåœ–ç‰‡

        const headImg = new Image();
        headImg.src = "https://img.icons8.com/color/48/snake.png"; // è›‡é ­åœ–ç‰‡

        const bodyImg = new Image();
        bodyImg.src = "https://img.icons8.com/color/48/filled-circle.png"; // è›‡èº« (ç¶ è‰²åœ“å½¢)

        // è›‡èˆ‡é£Ÿç‰©çš„åˆå§‹è¨­å®š
        let snake = [];
        snake[0] = { x: 9 * box, y: 10 * box };
        
        let food = {
            x: Math.floor(Math.random() * (canvasSize/box)) * box,
            y: Math.floor(Math.random() * (canvasSize/box)) * box
        };

        let score = 0;
        const scoreElement = document.getElementById("score");
        let d; // æ–¹å‘

        document.addEventListener("keydown", direction);

        function direction(event) {
            let key = event.keyCode;
            if( key == 37 && d != "RIGHT") d = "LEFT";
            else if(key == 38 && d != "DOWN") d = "UP";
            else if(key == 39 && d != "LEFT") d = "RIGHT";
            else if(key == 40 && d != "UP") d = "DOWN";
        }

        function collision(head, array){
            for(let i = 0; i < array.length; i++){
                if(head.x == array[i].x && head.y == array[i].y){
                    return true;
                }
            }
            return false;
        }

        function draw() {
            // æ¸…é™¤ç•«å¸ƒ
            ctx.clearRect(0, 0, canvasSize, canvasSize);

            // 1. ç•«è›‡
            for( let i = 0; i < snake.length; i++){
                let sX = snake[i].x;
                let sY = snake[i].y;

                if (i == 0) {
                    // --- ç•«è›‡é ­ (åŒ…å«æ—‹è½‰é‚è¼¯) ---
                    if (headImg.complete && headImg.naturalHeight !== 0) {
                        ctx.save(); // å„²å­˜ç•«å¸ƒç‹€æ…‹
                        
                        // ç§»å‹•ç•«å¸ƒä¸­å¿ƒé»åˆ°è›‡é ­çš„ä¸­å¿ƒ
                        ctx.translate(sX + box/2, sY + box/2);
                        
                        // æ ¹æ“šæ–¹å‘æ—‹è½‰
                        if (d == "LEFT") ctx.rotate(Math.PI);         // è½‰180åº¦ (å› ç‚ºåœ–ç‰‡é è¨­å¯èƒ½æœå³)
                        else if (d == "UP") ctx.rotate(-Math.PI/2);   // è½‰-90åº¦
                        else if (d == "DOWN") ctx.rotate(Math.PI/2);  // è½‰90åº¦
                        // RIGHT æ˜¯é è¨­æ–¹å‘ï¼Œä¸ç”¨è½‰ (å‡è¨­åœ–ç‰‡æ˜¯æœå³çš„ï¼Œè‹¥åœ–ç‰‡æœä¸Šå‰‡éœ€èª¿æ•´)
                        
                        // ç¹ªè£½åœ–ç‰‡ (åœ–ç‰‡é è¨­æ˜¯æœå³çš„åœ–ç¤ºæ•ˆæœæœ€å¥½)
                        ctx.drawImage(headImg, -box/2, -box/2, box, box);
                        
                        ctx.restore(); // æ¢å¾©ç•«å¸ƒç‹€æ…‹
                    } else {
                        // åœ–ç‰‡è¼‰å…¥å¤±æ•—æ™‚çš„å‚™æ¡ˆï¼šç•«æ·±ç¶ è‰²æ–¹å¡Š
                        ctx.fillStyle = "#2ed573";
                        ctx.fillRect(sX, sY, box, box);
                    }
                } else {
                    // --- ç•«è›‡èº« ---
                    if (bodyImg.complete && bodyImg.naturalHeight !== 0) {
                        // ç‚ºäº†è®“èº«é«”çœ‹èµ·ä¾†é€£æ¥ç·Šå¯†ï¼Œç¨å¾®ç•«å¤§ä¸€é»é»
                        ctx.drawImage(bodyImg, sX, sY, box, box);
                    } else {
                        // å‚™æ¡ˆï¼šç•«ç™½è‰²æ–¹å¡Š
                        ctx.fillStyle = "white";
                        ctx.fillRect(sX, sY, box, box);
                        ctx.strokeStyle = "#2b3a42";
                        ctx.strokeRect(sX, sY, box, box);
                    }
                }
            }

            // 2. ç•«é£Ÿç‰© (è˜‹æœ)
            if (appleImg.complete && appleImg.naturalHeight !== 0) {
                ctx.drawImage(appleImg, food.x, food.y, box, box);
            } else {
                // å‚™æ¡ˆï¼šç•«ç´…è‰²æ–¹å¡Š
                ctx.fillStyle = "#ff4757";
                ctx.fillRect(food.x, food.y, box, box);
            }

            // 3. éŠæˆ²é‚è¼¯ (ç§»å‹•)
            let snakeX = snake[0].x;
            let snakeY = snake[0].y;

            if( d == "LEFT") snakeX -= box;
            if( d == "UP") snakeY -= box;
            if( d == "RIGHT") snakeX += box;
            if( d == "DOWN") snakeY += box;

            // 4. åƒé£Ÿç‰©èˆ‡ç¢°æ’åˆ¤æ–·
            if(snakeX == food.x && snakeY == food.y){
                score++;
                scoreElement.innerText = score;
                food = {
                    x: Math.floor(Math.random() * (canvasSize/box)) * box,
                    y: Math.floor(Math.random() * (canvasSize/box)) * box
                }
            } else {
                snake.pop();
            }

            let newHead = { x : snakeX, y : snakeY };

            if(snakeX < 0 || snakeX >= canvasSize || snakeY < 0 || snakeY >= canvasSize || collision(newHead, snake)){
                clearInterval(game);
                
                // å»¶é²ä¸€ä¸‹é¡¯ç¤º Alertï¼Œè®“ç©å®¶çœ‹åˆ°æ’åˆ°çš„ç•«é¢
                setTimeout(() => {
                    alert("ğŸ’¥ å”‰å‘€ï¼æ’åˆ°äº†ï¼\næœ€çµ‚å¾—åˆ†: " + score);
                    location.reload(); // è‡ªå‹•é‡æ–°æ•´ç†
                }, 100);
                return;
            }

            snake.unshift(newHead);
        }

        // é€™è£¡è¨­å®šé€Ÿåº¦ï¼Œæ•¸å­—è¶Šå°è¶Šå¿« (åŸæœ¬100ï¼Œç¾åœ¨120ç¨å¾®æ…¢ä¸€é»é»ï¼Œæ–¹ä¾¿çœ‹åœ–å½¢)
        let game = setInterval(draw, 120);

    </script>
</body>
</html>